import{d as v,r as A,p as w,y,c as p,a as c,o as i,v as S,b as g,h as k,u as f}from"./vendor-DTIOB2Rm.js";import{u as E}from"./exhibit-BWOGU_Id.js";import{c as L,d as V,W as P,H as B}from"./three-DHOOThHx.js";import{G as C}from"./GLTFLoader-BDYM_Qw4.js";import{_ as R}from"./index-B7YiAMdU.js";const q={class:"ar-container"},G=v({__name:"ARViewer",props:{modelPath:{}},setup(m){const l=m,o=A(null);let e=null,s=null,a,_,n;const x=async()=>{if(!navigator.xr){console.warn("WebXR不支持");return}a=new L,_=new V,n=new P({canvas:o.value,antialias:!0,alpha:!0}),n.xr.enabled=!0;const t=new B(16777215,12303359,1);a.add(t);const d=new C;try{const u=(await d.loadAsync(l.modelPath)).scene;u.scale.set(.1,.1,.1),a.add(u)}catch(r){console.error("AR模型加载失败:",r)}},b=async()=>{try{const t=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"]});t.addEventListener("end",()=>{e=null,s=null}),await n.xr.setSession(t),e=t,s=await t.requestReferenceSpace("local"),n.setAnimationLoop((d,r)=>{if(!r)return;r.getViewerPose(s)&&n.render(a,_)})}catch(t){console.error("AR会话启动失败:",t)}},h=async()=>{e&&await e.end()};return w(()=>{x()}),y(()=>{h()}),(t,d)=>(i(),p("div",q,[c("canvas",{ref_key:"canvas",ref:o},null,512),c("div",{class:"ar-controls"},[c("button",{onClick:b},"开始AR体验"),c("button",{onClick:h},"结束AR体验")])]))}}),W=R(G,[["__scopeId","data-v-f7fcb334"]]),F={class:"ar-view"},H={key:1,class:"loading"},I=v({__name:"ARView",setup(m){const l=S(),o=g(),e=E();return w(async()=>{const s=l.params.id;await e.loadExhibitDetail(s),e.currentExhibit||o.push("/")}),(s,a)=>(i(),p("div",F,[f(e).currentExhibit?(i(),k(W,{key:0,"model-path":f(e).currentExhibit.modelPath},null,8,["model-path"])):(i(),p("div",H," 加载中... "))]))}}),U=R(I,[["__scopeId","data-v-c52bd7d4"]]);export{U as default};
